---
title: "Quality check 03, Block group intersections with community districts"
author: "Satya Golla and Steve Simon"
date: "Created 2022-03-21"
output: html_document
---

This program examines tracts that only partially intersect with community districts.

### Load relevant files

```{r setup}
library(sf)
library(tidyverse)
library(magrittr)
path_name <- "../data/"
load(paste0(path_name, "bl", ".RData"))
glimpse(bl)
load(paste0(path_name, "cd", ".RData"))
glimpse(cd)
load(paste0(path_name, "icd", ".RData"))
glimpse(icd)
load(paste0(path_name, "red", ".RData"))
glimpse(red)
load(paste0(path_name, "bg", ".RData"))
glimpse(bg)
load(paste0(path_name, "co", ".RData"))
clist <- c(
  "20091",
  "20103",
  "20209",
  "29037",
  "29047",
  "29095",
  "29165")
co                                     %>%
  filter(GEOID %in% clist)              -> co
glimpse(co)

```

### Find community ids

```{r find}
icd                                    %>%
  tibble                               %>%
  distinct(cd_id)                      %>%
  arrange(cd_id)                       %>%
  pull(cd_id)                           -> cd_list
```

```{r functions}
county_plot <- function(co, cd, i) {
  cd %<>% filter(cd_id==i)
  ggplot(co, aes())                     +
    geom_sf(
      fill=NA,
      color="darkgreen")                +
    ggtitle(cd$cd_name)                 +
    geom_sf(
      data=cd,
      aes(),
      fill="white",
      color="darkred")                  -> plot_co
  plot(plot_co)
}

extract_bg <- function(icd, i) {
  icd                                  %>%
    tibble                             %>%
    filter(cd_id==i)                   %>%
    distinct(bg_id)                    %>%
    arrange(bg_id)                     %>%
    pull(bg_id)                       
}

bg_plot <- function(cd, i, bg, bg_list, j) {
  cd %<>% filter(cd_id==i)
  bg %<>% filter(bg_id %in% bg_list)
  ggplot(cd, aes())                     +
    geom_sf(
      fill="white",
      color="darkred"
    )                                   +
    geom_sf(
      data=bg,
      aes(),
      fill="NA",
      color="lightgreen")               +
    geom_sf(
      data=slice(bg, j),
      aes(),
      fill="NA",
      color="darkgreen")                -> plot_bg
  plot(plot_bg)
}
```

```{r loop}
for (i in cd_list) {
  county_plot(co, cd, i)
  bg_list <- extract_bg(icd, i)
  for (j in 1:length(bg_list)) {
    bg_plot(cd, i, bg, bg_list, j)
  }
}
```


<!---Key census links go here--->
